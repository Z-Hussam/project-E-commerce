
{% extends 'base.html.twig' %}

{% block title %}Mon Panier{% endblock %}

{% block body %}

<div class="container my-5 py-3">
    <div class="text-center mb-5">
        <h1 class="fw-bolder text-dark">Votre Panier d'Achat</h1>
        <p class="lead text-muted">
            Revoyez l'ensemble des produits ajoutés avant de finaliser votre commande.
        </p>
    </div>

    {% if cart|length > 0 %}
        <div class="row g-4">

            <div class="col-12 col-lg-8">
                <h4 class="mb-4 fw-bold">Détail des Produits ({{ cart|length }} articles)</h4>

                <div class="d-grid gap-3">
                    {% for product in cart %}
                        <div class="card border-0 shadow-sm rounded-3">
                            <div class="card-body p-3 p-md-4">
                                <div class="row align-items-center g-3">
                                    
                                    <div class="col-3 col-md-2">
                                        <a href="{{ path('app_product', {'slug': product.object.slug}) }}">
                                            <img 
                                                src="/uploads/{{ product.object.illustration }}" 
                                                alt="{{ product.object.name }}" 
                                                class="img-fluid rounded-2 border"
                                                style="height: 100px; object-fit: cover; width: 100%;"
                                            >
                                        </a>
                                    </div>
                                    
                                    <div class="col-9 col-md-5">
                                        <h5 class="fw-bold mb-1">{{ product.object.name }}</h5>
                                        <span class="d-block small text-muted">Prix unitaire: {{ product.object.pricewt|price }}</span>
                                    </div>

                                    <div class="col-7 col-md-3 d-flex justify-content-center align-items-center gap-2">
                                        <a href="{{ path('app_cart_minus', { id: product.object.id }) }}" 
                                           class="btn btn-outline-secondary btn-sm" 
                                           aria-label="Retirer une unité">-</a>
                                           
                                        <span class="fw-bold px-2 text-secondary">
                                            {{ product.qty }}
                                        </span>
                                        
                                        <a href="{{ path('app_cart_add', { id: product.object.id }) }}" 
                                           class="btn btn-outline-secondary btn-sm" 
                                           aria-label="Ajouter une unité">+</a>
                                    </div>

                                    <div class="col-5 col-md-2 text-end">
                                        <strong class="text-secondary fw-bolder d-block mb-2">
                                            {{ (product.qty * product.object.priceWt)|price }}
                                        </strong>
            
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div class="mt-4 text-end">
                     <a href="{{ path('app_cart_remove') }}" class="btn btn-outline-danger btn-sm text-uppercase">
                        <i class="bi bi-trash-fill me-2"></i> Vider tout le panier
                    </a>
                </div>
            </div>

            <div class="col-12 col-lg-4">
                <div class="  p-4 sticky-top" style="top: 2rem;">
                    <h4 class="card-title mb-4 fw-bold text-dark border-bottom pb-2">Récapitulatif</h4>

                    <div class="d-flex justify-content-between py-2">
                        <span class="text-muted">Nombre d'articles</span>
                        <span class="fw-semibold">{{ fullCartQuantity }}</span>
                    </div>

                    <div class="d-flex justify-content-between pt-3 border-top">
                        <span class="fw-bold fs-5">Total produits</span>
                        <span class="fw-bolder fs-5 text-secondary">{{ totalWt|price }}</span>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{{ path('app_order') }}" class="btn text-white bg-dark  btn-sm w-100  py-3 ">
                             Commander
                        </a>
                    </div>
                    
                    <p class="small text-center text-muted mt-3 mb-0">
                        Frais de port et taxes calculés à l'étape suivante.
                    </p>
                </div>
            </div>
        </div>

    {% else %}
        <div class="alert alert-dark text-center rounded-3 p-5 my-5" role="alert">
            <h4 class="alert-heading"><i class="bi bi-bag-x-fill me-2"></i> Votre panier est vide.</h4>
            <p>Il semble que vous n'ayez encore rien ajouté. Parcourez nos produits pour commencer vos achats !</p>
            <hr>
            <a href="{{ path('app_home') }}" class="btn bg-dark bg-opacity-75 text-white fw-bold">Retourner à l'accueil</a>
        </div>
    {% endif %}
</div>
{% endblock %}